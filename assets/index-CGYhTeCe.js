var x=Object.defineProperty;var E=(c,n,t)=>n in c?x(c,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[n]=t;var o=(c,n,t)=>E(c,typeof n!="symbol"?n+"":n,t);import{P as d}from"./phaser-0RJB29YE.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=t(e);fetch(e.href,s)}})();class S extends d.GameObjects.Group{constructor(t){super(t.scene);o(this,"gridWidth");o(this,"gridHeight");o(this,"cellSize");this.gridWidth=t.width,this.gridHeight=t.height,this.cellSize=t.cellSize,t.scene.add.existing(this),this.createGrid(t.x,t.y)}createGrid(t,i){for(let h=0;h<this.gridHeight;h++)for(let l=0;l<this.gridWidth;l++){const u=t+l*this.cellSize+this.cellSize/2,f=i+h*this.cellSize+this.cellSize/2,g=this.scene.add.image(u,f,"block");g.setDisplaySize(this.cellSize,this.cellSize),g.setTint(4473924),g.setAlpha(.5),this.add(g)}const e=4,s=16777215,r=.7,a=this.scene.add.graphics({x:t,y:i});a.lineStyle(e,s,r),a.strokeRect(0,0,this.gridWidth*this.cellSize,this.gridHeight*this.cellSize),this.add(a)}}function m(c){const n=c.length,t=c[0].length,i=Array.from({length:t},()=>Array(n).fill(0));for(let e=0;e<n;e++)for(let s=0;s<t;s++)i[s][n-1-e]=c[e][s];return i}function C(c){const n=c.length,t=c[0].length,i=Array.from({length:t},()=>Array(n).fill(0));for(let e=0;e<n;e++)for(let s=0;s<t;s++)i[t-1-s][e]=c[e][s];return i}function I(c){return c.map(n=>n.slice().reverse())}function y(c){if(!c||c.length===0)return[[0]];let n=c.length,t=-1,i=c[0].length,e=-1;for(let r=0;r<c.length;r++)for(let a=0;a<c[0].length;a++)c[r][a]===1&&(n=Math.min(n,r),t=Math.max(t,r),i=Math.min(i,a),e=Math.max(e,a));if(t===-1)return[[0]];const s=[];for(let r=n;r<=t;r++)s.push(c[r].slice(i,e+1));return s}class G extends d.GameObjects.Container{constructor(t){super(t.scene,t.x,t.y);o(this,"matrix");o(this,"cellSize");o(this,"blockColor");o(this,"debugGraphics");o(this,"isPlaced",!1);o(this,"startX");o(this,"startY");this.matrix=t.matrix,this.cellSize=t.cellSize,this.startX=t.x,this.startY=t.y,this.blockColor=t.color||65280,this.debugGraphics=this.scene.add.graphics(),this.add(this.debugGraphics),this.scene.add.existing(this),this.drawShape(),this.setInteractiveAndHitArea(),this.updateSizeAndHitArea()}get color(){return this.blockColor}updateSizeAndHitArea(){if(!this.input)return;const t=this.matrix[0].length*this.cellSize,i=this.matrix.length*this.cellSize;this.setSize(t,i);const e=this.input.hitArea;e.setPosition(-t/2,-i/2),e.setSize(t,i)}drawShape(){this.list.filter(a=>a!==this.debugGraphics).forEach(a=>a.destroy());const i=this.matrix[0].length*this.cellSize,e=this.matrix.length*this.cellSize,s=i/2,r=e/2;for(let a=0;a<this.matrix.length;a++)for(let h=0;h<this.matrix[0].length;h++)if(this.matrix[a][h]===1){const l=h*this.cellSize-s+this.cellSize/2,u=a*this.cellSize-r+this.cellSize/2,f=this.scene.add.rectangle(l,u,this.cellSize,this.cellSize);f.setOrigin(.5,.5),f.setStrokeStyle(1,0,.5);const g=this.isPlaced?d.Display.Color.ValueToColor(this.blockColor).darken(30).color:this.blockColor;f.setFillStyle(g),this.add(f)}this.bringToTop(this.debugGraphics)}setInteractiveAndHitArea(){if(this.input)return;const t=new d.Geom.Rectangle(0,0,0,0);this.setInteractive({hitArea:t,hitAreaCallback:(i,e,s,r)=>{const a=r,h=Math.floor(e/a.cellSize),l=Math.floor(s/a.cellSize);return!!(a.matrix[l]&&a.matrix[l][h]===1)},draggable:!0,useHandCursor:!0}),this.on("dragstart",()=>{this.scene.children.bringToTop(this),this.scene.tweens.add({targets:this,scale:1.1,ease:"Power1",duration:150})}),this.on("drag",(i,e,s)=>{this.x=e,this.y=s,this.emit("dragging",this)}),this.on("dragend",i=>{this.scene.tweens.add({targets:this,scale:1,ease:"Power1",duration:150,onComplete:()=>this.emit("dropped",this)})})}transform(t){this.isPlaced||(this.matrix=t(this.matrix),this.drawShape(),this.updateSizeAndHitArea(),this.emit("transformed",this))}place(){this.isPlaced=!0,this.disableInteractive(),this.drawShape()}returnToStart(){this.scene.tweens.add({targets:this,x:this.startX,y:this.startY,ease:"Power1",duration:200})}rotateCW(){this.transform(m)}rotateCCW(){this.transform(C)}flip(){this.transform(I)}getGridCells(t,i){const e=[];for(let s=0;s<this.matrix.length;s++)for(let r=0;r<this.matrix[0].length;r++)this.matrix[s][r]===1&&e.push({x:t+r,y:i+s});return e}getProjectedGridInfo(t,i,e){const s=this.x-this.width/2,r=this.y-this.height/2,a=Math.round((s-t)/e),h=Math.round((r-i)/e),l=this.getGridCells(a,h);return{col:a,row:h,cells:l}}snapToGrid(t,i,e,s,r){this.x=t+s*e+this.width/2,this.y=i+r*e+this.height/2}}class v extends d.Scene{constructor(){super({key:"MainScene"});o(this,"mainGridMatrix");o(this,"placedBlocksMatrix",[]);o(this,"previewGraphics");o(this,"activeShape");o(this,"superShapeMatrix");o(this,"score",0);o(this,"GRID_WIDTH",11);o(this,"GRID_HEIGHT",11);o(this,"CELL_SIZE",72);o(this,"gridX",0);o(this,"gridY",0)}init(t){this.superShapeMatrix=t.superShapeData||[[1]]}create(){this.cameras.main.setBackgroundColor("#2c3e50"),this.initMainGrid(),this.createActiveShape(),this.previewGraphics=this.add.graphics(),this.createControlButtons(),this.setupInputHandling(),this.events.on(d.Scenes.Events.WAKE,this.onWake,this),this.add.text(this.cameras.main.centerX,60,"Place the Shape",{fontSize:"56px",color:"#ffffff"}).setOrigin(.5)}initMainGrid(){this.gridX=(this.cameras.main.width-this.GRID_WIDTH*this.CELL_SIZE)/2,this.gridY=(this.cameras.main.height-this.GRID_HEIGHT*this.CELL_SIZE)/5,new S({scene:this,x:this.gridX,y:this.gridY,width:this.GRID_WIDTH,height:this.GRID_HEIGHT,cellSize:this.CELL_SIZE}),this.mainGridMatrix=Array.from({length:this.GRID_HEIGHT},()=>Array(this.GRID_WIDTH).fill(0)),this.placedBlocksMatrix=Array.from({length:this.GRID_HEIGHT},()=>Array(this.GRID_WIDTH).fill(null))}createActiveShape(){const i=this.gridY+this.GRID_HEIGHT*this.CELL_SIZE+300;this.activeShape=new G({scene:this,x:this.cameras.main.width/2,y:i,matrix:this.superShapeMatrix,cellSize:this.CELL_SIZE,color:16753920}),this.activeShape.startX=this.activeShape.x,this.activeShape.startY=this.activeShape.y,this.activeShape.on("dragging",e=>{this.updateDropPreview(e)}),this.activeShape.on("dropped",e=>{this.previewGraphics.clear(),this.handleShapeDrop(e)}),this.activeShape.on("transformed",e=>{this.updateDropPreview(e)}),this.canShapeBePlacedAnywhere(this.activeShape)||this.triggerGameOver()}onWake(){const t=this.game.registry.get("superShapeData");t&&(this.activeShape&&this.activeShape.destroy(),this.superShapeMatrix=t,this.createActiveShape(),this.game.registry.remove("superShapeData"))}setupInputHandling(){this.game.events.on("rotateCWClicked",()=>this.activeShape.rotateCW()),this.game.events.on("rotateCCWClicked",()=>this.activeShape.rotateCCW()),this.game.events.on("flipClicked",()=>this.activeShape.flip()),this.events.on(d.Scenes.Events.SHUTDOWN,()=>{this.game.events.off("rotateCWClicked"),this.game.events.off("rotateCCWClicked"),this.game.events.off("flipClicked"),this.events.off(d.Scenes.Events.WAKE,this.onWake,this)})}createControlButtons(){const t=this.cameras.main.height-150,i={fontSize:"42px",color:"#ffffff",backgroundColor:"#555555",padding:{x:22,y:8}},e=this.cameras.main.width/2,s=100,r=e-s,a=this.add.text(r,t,"↷",i).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.game.events.emit("rotateCWClicked"),a.setScale(.95)}).on("pointerup",()=>a.setScale(1)),h=this.add.text(e,t,"↔",i).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.game.events.emit("flipClicked"),h.setScale(.95)}).on("pointerup",()=>h.setScale(1)),l=this.add.text(e+s,t,"↶",i).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.game.events.emit("rotateCCWClicked"),l.setScale(.95)}).on("pointerup",()=>l.setScale(1))}handleShapeDrop(t){const{cells:i}=t.getProjectedGridInfo(this.gridX,this.gridY,this.CELL_SIZE);i.every(s=>s.x>=0&&s.x<this.GRID_WIDTH&&s.y>=0&&s.y<this.GRID_HEIGHT&&this.mainGridMatrix[s.y][s.x]===0)?(i.forEach(s=>{this.mainGridMatrix[s.y][s.x]=1;const r=this.add.rectangle(this.gridX+s.x*this.CELL_SIZE+this.CELL_SIZE/2,this.gridY+s.y*this.CELL_SIZE+this.CELL_SIZE/2,this.CELL_SIZE,this.CELL_SIZE,t.color);r.setStrokeStyle(1,0,.5),this.placedBlocksMatrix[s.y][s.x]=r}),t.destroy(),this.checkForClears()):t.returnToStart()}updateDropPreview(t){this.previewGraphics.clear();const{cells:i}=t.getProjectedGridInfo(this.gridX,this.gridY,this.CELL_SIZE),s=i.every(r=>r.x>=0&&r.x<this.GRID_WIDTH&&r.y>=0&&r.y<this.GRID_HEIGHT&&this.mainGridMatrix[r.y][r.x]===0)?4521796:16729156;this.previewGraphics.fillStyle(s,.5),i.forEach(r=>{if(r.x>=0&&r.x<this.GRID_WIDTH&&r.y>=0&&r.y<this.GRID_HEIGHT){const a=this.gridX+r.x*this.CELL_SIZE,h=this.gridY+r.y*this.CELL_SIZE;this.previewGraphics.fillRect(a,h,this.CELL_SIZE,this.CELL_SIZE)}})}checkForClears(){const t=[];for(let e=0;e<this.GRID_HEIGHT;e++)this.mainGridMatrix[e].every(s=>s===1)&&t.push(e);const i=[];for(let e=0;e<this.GRID_WIDTH;e++){let s=!0;for(let r=0;r<this.GRID_HEIGHT;r++)if(this.mainGridMatrix[r][e]===0){s=!1;break}s&&i.push(e)}t.length>0||i.length>0?this.clearLinesAndColumns(t,i):this.time.delayedCall(500,this.endPhase,[],this)}clearLinesAndColumns(t,i){const e=t.length+i.length,s=100,r=50;this.score+=s*e+r*(e>1?e-1:0),this.game.events.emit("updateScore",this.score),t.forEach(a=>{for(let h=0;h<this.GRID_WIDTH;h++)this.placedBlocksMatrix[a][h]&&(this.placedBlocksMatrix[a][h].destroy(),this.placedBlocksMatrix[a][h]=null),this.mainGridMatrix[a][h]=0}),i.forEach(a=>{for(let h=0;h<this.GRID_HEIGHT;h++)this.placedBlocksMatrix[h][a]&&(this.placedBlocksMatrix[h][a].destroy(),this.placedBlocksMatrix[h][a]=null),this.mainGridMatrix[h][a]=0}),this.time.delayedCall(500,this.endPhase,[],this)}endPhase(){console.log("Phase complete. Returning to BuildScene."),this.game.registry.set("mainGridMatrix",this.mainGridMatrix),this.scene.switch("BuildScene")}triggerGameOver(){console.log("GAME OVER"),this.activeShape&&this.activeShape.disableInteractive(),this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.7).setDepth(100),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-100,"GAME OVER",{fontSize:"128px",color:"#ff4444",fontStyle:"bold",stroke:"#ffffff",strokeThickness:8}).setOrigin(.5).setDepth(101),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+100,"Restart",{fontSize:"64px",color:"#ffffff",backgroundColor:"#555555",padding:{x:20,y:10}}).setOrigin(.5).setDepth(101).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.score=0,this.game.events.emit("updateScore",this.score);const i=11,s=Array.from({length:11},()=>Array(i).fill(0));this.game.registry.set("mainGridMatrix",s),this.scene.get("BuildScene").scene.restart(),this.scene.start("BuildScene")})}canShapeBePlacedAnywhere(t){let i=t.matrix;for(let e=0;e<4;e++){if(this.canMatrixBePlaced(i)||this.canMatrixBePlaced(I(i)))return!0;i=m(i)}return!1}canMatrixBePlaced(t){for(let i=-t.length+1;i<this.GRID_HEIGHT;i++)for(let e=-t[0].length+1;e<this.GRID_WIDTH;e++)if(this.canPlaceMatrixAt(t,e,i))return!0;return!1}canPlaceMatrixAt(t,i,e){for(let s=0;s<t.length;s++)for(let r=0;r<t[0].length;r++)if(t[s][r]===1){const a=e+s,h=i+r;if(a<0||a>=this.GRID_HEIGHT||h<0||h>=this.GRID_WIDTH||this.mainGridMatrix[a][h]===1)return!1}return!0}}class H{generateShapeMatrix(n=2,t=5,i=3){const e=Array.from({length:i},()=>Array(i).fill(0)),s=Phaser.Math.Between(n,t);let r=0;const a=[[-1,0],[0,1],[1,0],[0,-1]],h=[],l=Phaser.Math.Between(0,i-1),u=Phaser.Math.Between(0,i-1);for(e[l][u]=1,h.push({r:l,c:u}),r++;r<s&&h.length>0;){const f=Phaser.Math.RND.pick(h),g=a.map(p=>({r:f.r+p[0],c:f.c+p[1]})).filter(p=>p.r>=0&&p.r<i&&p.c>=0&&p.c<i&&e[p.r][p.c]===0);if(g.length>0){const p=Phaser.Math.RND.pick(g);e[p.r][p.c]=1,h.push(p),r++}else h.splice(h.indexOf(f),1)}return this.trimMatrix(e)}trimMatrix(n){let t=n.length,i=-1,e=n[0].length,s=-1;for(let a=0;a<n.length;a++)for(let h=0;h<n[0].length;h++)n[a][h]===1&&(t=Math.min(t,a),i=Math.max(i,a),e=Math.min(e,h),s=Math.max(s,h));if(i===-1)return[[1]];const r=[];for(let a=t;a<=i;a++)r.push(n[a].slice(e,s+1));return r}}class w extends d.Scene{constructor(){super({key:"BuildScene"});o(this,"buildGridMatrix");o(this,"sourceShapes",[]);o(this,"shapeFactory");o(this,"previewGraphics");o(this,"hintPreviewGraphics");o(this,"GRID_WIDTH",7);o(this,"GRID_HEIGHT",7);o(this,"CELL_SIZE",80);o(this,"gridX",0);o(this,"gridY",0)}create(){this.events.on(d.Scenes.Events.WAKE,this.resetScene,this),this.events.on(d.Scenes.Events.SHUTDOWN,()=>{this.events.off(d.Scenes.Events.WAKE,this.resetScene,this)}),this.resetScene()}resetScene(){this.sourceShapes.forEach(t=>t.destroy()),this.sourceShapes=[],this.children.removeAll(),this.shapeFactory=new H,this.initBuildGrid(),this.previewGraphics=this.add.graphics(),this.hintPreviewGraphics=this.add.graphics().setDepth(10),this.generateSourceShapes(),this.createHintButton(),this.add.text(this.cameras.main.centerX,110,"Compose Your Shape",{fontSize:"56px",color:"#ffffff"}).setOrigin(.5)}initBuildGrid(){this.gridX=Math.floor((this.cameras.main.width-this.GRID_WIDTH*this.CELL_SIZE)/2),this.gridY=200,new S({scene:this,x:this.gridX,y:this.gridY,width:this.GRID_WIDTH,height:this.GRID_HEIGHT,cellSize:this.CELL_SIZE}),this.buildGridMatrix=Array.from({length:this.GRID_HEIGHT},()=>Array(this.GRID_WIDTH).fill(0))}generateSourceShapes(){const t=this.gridY+this.GRID_HEIGHT*this.CELL_SIZE,i=220,e=3*this.CELL_SIZE,s=40,r=t+i,a=r+e+s,h=Math.floor(this.cameras.main.width/4);for(let l=0;l<3;l++){const u=this.shapeFactory.generateShapeMatrix(2,6,3),f=Math.floor(h*(l+1)),g=new G({scene:this,x:f,y:r,matrix:u,cellSize:this.CELL_SIZE,color:56797});this.sourceShapes.push(g),g.on("dragging",p=>{p.isPlaced||(this.updateDropPreview(p),this.children.bringToTop(this.previewGraphics))}),g.on("dropped",p=>{this.previewGraphics.clear(),this.handleShapeDrop(p)}),this.createShapeButtons(g,f,a)}}createShapeButtons(t,i,e){const r={fontSize:"48px",color:"#ffffff",backgroundColor:"#555555",padding:{x:22,y:8},align:"center"};this.add.text(i+80,e,"↶",r).setOrigin(.5).setInteractive().on("pointerdown",()=>t.rotateCCW()),this.add.text(i-80,e,"↷",r).setOrigin(.5).setInteractive().on("pointerdown",()=>t.rotateCW()),this.add.text(i,e,"↔",r).setOrigin(.5).setInteractive().on("pointerdown",()=>t.flip())}handleShapeDrop(t){const{col:i,row:e,cells:s}=t.getProjectedGridInfo(this.gridX,this.gridY,this.CELL_SIZE);s.every(a=>a.x>=0&&a.x<this.GRID_WIDTH&&a.y>=0&&a.y<this.GRID_HEIGHT&&this.buildGridMatrix[a.y][a.x]===0)?(s.forEach(a=>{this.buildGridMatrix[a.y][a.x]=1}),t.snapToGrid(this.gridX,this.gridY,this.CELL_SIZE,i,e),t.place(),this.sourceShapes.every(a=>a.isPlaced)&&this.time.delayedCall(250,this.confirmComposition,[],this)):t.returnToStart()}updateDropPreview(t){this.previewGraphics.clear();const{cells:i}=t.getProjectedGridInfo(this.gridX,this.gridY,this.CELL_SIZE),s=i.every(r=>r.x>=0&&r.x<this.GRID_WIDTH&&r.y>=0&&r.y<this.GRID_HEIGHT&&this.buildGridMatrix[r.y][r.x]===0)?4521796:16729156;this.previewGraphics.fillStyle(s,.5),i.forEach(r=>{if(r.x>=0&&r.x<this.GRID_WIDTH&&r.y>=0&&r.y<this.GRID_HEIGHT){const a=this.gridX+r.x*this.CELL_SIZE,h=this.gridY+r.y*this.CELL_SIZE;this.previewGraphics.fillRect(a,h,this.CELL_SIZE,this.CELL_SIZE)}})}confirmComposition(){console.log("Composition confirmed! Generating super-shape...");const t=y(this.buildGridMatrix),i=this.scene.get("MainScene");i&&i.sys.isSleeping()?(this.game.registry.set("superShapeData",t),this.scene.switch("MainScene")):this.scene.start("MainScene",{superShapeData:t})}createHintButton(){const t=this.add.text(460,1355,"HINT",{fontSize:"48px",color:"#ffffff",backgroundColor:"#0000ff",padding:{x:40,y:20}}).setInteractive();t.on("pointerdown",()=>{this.showHintPreview(!0)}),t.on("pointerup",()=>{this.showHintPreview(!1)}),t.on("pointerout",()=>{this.showHintPreview(!1)})}showHintPreview(t){if(this.hintPreviewGraphics.clear(),!t)return;const i=this.game.registry.get("mainGridMatrix");if(!i)return;const e=51,s=11,r=11,a=259,h=199;this.hintPreviewGraphics.fillStyle(0,.7),this.hintPreviewGraphics.fillRect(a-10,h-10,s*e+20,r*e+20);for(let l=0;l<r;l++)for(let u=0;u<s;u++){const f=i[l][u]===1?16777215:5592405;this.hintPreviewGraphics.fillStyle(f,.9),this.hintPreviewGraphics.fillRect(a+u*e,h+l*e,e-1,e-1)}}}class D extends d.Scene{constructor(){super({key:"UIScene"});o(this,"pointerDebugText");o(this,"scoreText")}create(){this.scoreText=this.add.text(20,40,"Score: 0",{fontSize:"48px",color:"#ffffff",fontStyle:"bold"}),this.game.events.on("updateScore",i=>{this.scoreText.setText(`Score: ${i}`)});const t={color:"#00ff00",fontSize:"24px",fontFamily:"Arial",stroke:"#000000",strokeThickness:4};this.pointerDebugText=this.add.text(10,10,"Pointer: (0, 0)",t),this.pointerDebugText.setDepth(100)}update(){const t=this.input.activePointer,i=Math.floor(t.worldX),e=Math.floor(t.worldY);this.pointerDebugText.setText(`Pointer: (${i}, ${e})`)}}class _ extends d.Scene{constructor(){super({key:"BootScene"});o(this,"gameStarted",!1)}create(){this.gameStarted||(this.startGame(),this.gameStarted=!0)}startGame(){const e=Array.from({length:11},()=>Array(11).fill(0));this.game.registry.set("mainGridMatrix",e),this.scene.start("StartScene")}}class T extends d.Scene{constructor(){super({key:"StartScene"})}create(){this.cameras.main.setBackgroundColor("#000000"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Start Game",{fontSize:"64px",color:"#000000",backgroundColor:"#ffffff",padding:{x:30,y:20}}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.sys.game.device.input.touch&&this.scale.startFullscreen(),this.scene.start("BuildScene"),this.scene.launch("UIScene")})}}const M={type:d.AUTO,parent:"game-container",width:1080,height:1920,scene:[_,T,v,D,w],scale:{mode:d.Scale.FIT,autoCenter:d.Scale.CENTER_BOTH,min:{width:450,height:800},max:{width:1080,height:1920}}};new d.Game(M);
